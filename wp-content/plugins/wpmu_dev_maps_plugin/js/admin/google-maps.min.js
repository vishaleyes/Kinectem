/*! Google Maps - v2.9.07
 * http://premium.wpmudev.org/project/wordpress-google-maps-plugin
 * Copyright (c) 2015; * Licensed GPLv2+ */
window.AgmMapHandler=null,jQuery(function(){window.AgmMapHandler=function(e,a,t){function i(){P=a,a.zoom=a.zoom||a.defaults.zoom,a.zoom=parseInt(a.zoom)?parseInt(a.zoom):1,a.show_map="show_map"in a?a.show_map:1,a.show_posts="show_posts"in a?a.show_posts:0,a.show_markers="show_markers"in a?a.show_markers:1,a.show_images="show_images"in a?a.show_images:0,a.snapping="snapping"in a.defaults?parseInt(a.defaults.snapping):1,a.show_panoramio_overlay="show_panoramio_overlay"in a?parseInt(a.show_panoramio_overlay):0,a.panoramio_overlay_tag="panoramio_overlay_tag"in a?a.panoramio_overlay_tag:"",a.street_view="street_view"in a?a.street_view:0,a.street_view_pos="street_view_pos"in a?a.street_view_pos:0,a.street_view_pov="street_view_pov"in a?a.street_view_pov:0,a.map_type=a.map_type||a.defaults.map_type,a.map_alignment=a.map_alignment||a.defaults.map_alignment,a.post_ids=a.post_ids||[],a.image_size=a.image_size||a.defaults.image_size,a.image_limit=a.image_limit||a.defaults.image_limit}function n(){var e=jQuery("#agm_mh_map_id").val();return!e||jQuery(this).is(":disabled")?(window.alert(l10nStrings.please_save_map),!1):(E(),U.trigger("agm_map_insert",[e]),void 0)}function o(){var e=jQuery("#agm_save_status_pending"),a=jQuery("#agm_save_status_done"),t=jQuery("#agm_map_title").val();if(!t)return window.alert(l10nStrings.map_name_missing),!1;e.show(),a.hide();var i=L.getStreetView(),n=jQuery("#agm_map_size_x").is(":enabled")?jQuery("#agm_map_size_x").val():0,o=jQuery("#agm_map_size_y").is(":enabled")?jQuery("#agm_map_size_y").val():0,s=jQuery("input.agm_map_alignment_element:checked").val(),r={action:"agm_save_map",id:jQuery("#agm_mh_map_id").val(),title:t,height:o,width:n,zoom:L.getZoom(),map_type:L.getMapTypeId(),show_map:jQuery("#agm_map_show_map").is(":checked")?1:0,show_posts:jQuery("#agm_map_show_posts").is(":checked")?1:0,map_alignment:s,show_markers:jQuery("#agm_map_show_markers").is(":checked")?1:0,show_images:jQuery("#agm_map_show_images").is(":checked")?1:0,image_size:jQuery("#agm_map_image_size").val(),image_limit:jQuery("#agm_map_image_limit").val(),show_panoramio_overlay:jQuery("#agm_map_show_panoramio_overlay").is(":checked")?1:0,panoramio_overlay_tag:jQuery("#agm_map_panoramio_overlay_tag").val(),street_view:i.getVisible()?1:0,street_view_pos:i.getVisible()?[i.getPosition().lat(),i.getPosition().lng()]:0,street_view_pov:i.getVisible()?i.getPov():0,post_ids:[],markers:[]};jQuery.each(jQuery("input.agm_mh_associated_id"),function(e,a){r.post_ids[r.post_ids.length]=jQuery(a).val()}),jQuery("#agm_map_size_associate").is(":checked")&&(r.post_ids[r.post_ids.length]=jQuery("#post_ID").val()),jQuery.each(D,function(e,a){var t=a.getPosition();if(!t)return!0;var i={title:a.getTitle(),body:a._agmBody,icon:a.getIcon(),position:[t.lat(),t.lng()]};r.markers[r.markers.length]=i}),jQuery(document).trigger("agm_google_maps-admin-save_request",[r]),jQuery.post(window.ajaxurl,r,function(t){e.hide(),t.status?(a.show(),jQuery("#agm_mh_map_id").val(parseInt(t.id)),jQuery("#agm_insert_map").attr("disabled",!1),jQuery(document).trigger("agm-map-saved",[parseInt(t.id)]),U.trigger("agm_map_saved",[parseInt(t.id)]),window.setTimeout(function(){a.hide()},3e3)):window.alert(l10nStrings.map_not_saved)})}function s(){return a.post_ids.length?(jQuery.post(window.ajaxurl,{action:"agm_get_post_titles",post_ids:a.post_ids},function(e){if(!e.posts)return!1;var a='<div class="agm_less_important">'+l10nStrings.already_associated_width+'<ul class="agm_associated_list">';jQuery("#post_ID").val(),jQuery.each(e.posts,function(e,t){a+="<li>"+t.post_title+"</li>"}),a+="</ul></div>",jQuery("#agm_map_associated_posts").html(a)}),!1):(jQuery("#agm_map_associated_posts").html(""),jQuery("#agm_map_size_associate").attr("checked",!1),!1)}function r(){var e,i="",n="";jQuery.each(a.post_ids,function(e,a){i+='<input type="hidden" class="agm_mh_associated_id" value="'+a+'" />'}),jQuery.each(V,function(e,t){var i=t===a.image_size?'selected="selected"':"";n+='<option value="'+t+'" '+i+">"+t+"</option>"}),U.html('<div class="agm-preview"></div><div class="agm-options" id="agm_mh_options" style="display:none"></div>'),U.find(".agm-preview").append('<div id="agm_mh_header"><input type="hidden" id="agm_mh_map_id"><div class="agm_mh_container"><input type="text" size="32" class="widefat" id="agm_map_title" placeholder="'+l10nStrings.map_title+'" />'+"</div>"+'<div class="agm_mh_container marker-buttons">'+'<label for="agm_mh_location">'+l10nStrings.add_location+" </label>"+'<input type="text" id="agm_mh_location" />'+'<button type="button" class="button-secondary action" id="agm_mh_location_trigger">'+'<i class="dashicons dashicons-location"></i> '+l10nStrings.add+"</button>"+'<span id="agm_map_drop_marker_controls_container">'+'<button type="button" class="button-secondary action" id="agm_map_drop_marker"><i class="dashicons dashicons-location"></i> '+l10nStrings.drop_marker+"</button>"+'<div id="agm_map_zoom_in_help" class="agm_less_important">'+l10nStrings.zoom_in_help+"</div>"+"</span>"+"</div>"+"</div>"+'<div class="map_preview"></div>'+'<div id="agm_mh_footer" class="agm_mh_footer">'+'<div class="agm_mh_container" id="agm_mh_markers">'+"</div>"+"</div>"),e=U.parents(".agm-editor"),e.find(".buttons").append('<div class="detail-buttons">'+(e.hasClass("agm-no-back")?"":'<button type="button" class="button-secondary action agm_go_back"><i class="dashicons dashicons-arrow-left"></i> '+l10nStrings.go_back+"</button>")+'<span class="map-actions">'+'<span class="agm-status-text" id="agm_save_status_pending" style="display:none">'+l10nStrings.saving+"</span>"+'<span class="agm-status-text" id="agm_save_status_done" style="display:none">'+l10nStrings.saved+"</span>"+(t?'<button type="button" class="button-secondary action" id="agm_insert_map"><i class="dashicons dashicons-pressthis"></i> '+l10nStrings.insert+"</button>":"")+'<button type="button" class="button-secondary action agm_map_options_open"'+'data-tooltip="'+l10nStrings.options_help+'" data-width="500"'+">"+'<i class="dashicons dashicons-admin-generic"></i> '+l10nStrings.options+"</button>"+'<button type="button" class="button-secondary action agm_map_options_close" style="display:none">'+'<i class="dashicons dashicons-yes"></i> '+l10nStrings.apply_settings+"</button>"+'<button type="button" class="button-primary agm_save_map">'+'<i class="dashicons dashicons-yes"></i> '+l10nStrings.save+"</button>"+"</span>"+"</div>"),U.find(".agm-options").append('<div><label for="agm_map_size_associate"><input type="checkbox" id="agm_map_size_associate" value="'+jQuery("#post_ID").val()+'" /> '+l10nStrings.map_associate+"</label>"+'<div class="agm_less_important">'+l10nStrings.association_help+"</div>"+i+'<div id="agm_map_associated_posts"></div>'+"</div>"+"<fieldset>"+"<legend>"+l10nStrings.map_size+"</legend>"+"<div>"+'<input type="text" size="3" id="agm_map_size_x" />'+"&nbsp;x&nbsp;"+'<input type="text" size="3" id="agm_map_size_y" />'+"</div>"+"<div>"+"<label>"+'<input type="checkbox" id="agm_map_size_default" /> '+l10nStrings.use_default_size+"</label>"+"</div>"+"</fieldset>"+"<fieldset>"+"<legend>"+l10nStrings.map_appearance+"</legend>"+"<div>"+"<label>"+'<input type="checkbox" id="agm_map_show_posts" /> '+l10nStrings.show_posts+"</label>"+"</div>"+"<div>"+'<label for="agm_map_show_map">'+'<input type="checkbox" id="agm_map_show_map" /> '+l10nStrings.show_map+"</label>"+"</div>"+"<div>"+'<label for="agm_map_show_markers">'+'<input type="checkbox" id="agm_map_show_markers" /> '+l10nStrings.show_markers+"</label>"+"</div>"+"</fieldset>"+"<fieldset>"+"<legend>"+l10nStrings.images_strip+"</legend>"+"<div>"+"<label>"+'<input type="checkbox" id="agm_map_show_images" /> '+l10nStrings.show_images+"</label>"+"</div>"+"<div>"+'<label for="agm_map_image_size">'+l10nStrings.image_size+"</label> "+'<select id="agm_map_image_size">'+n+"</select>"+"</div>"+"<div>"+'<label for="agm_map_image_limit">'+l10nStrings.image_limit+"</label> "+'<input type="text" size="2" id="agm_map_image_limit" value="'+a.image_limit+'" />'+"</div>"+"</fieldset>"+"<fieldset>"+"<legend>"+l10nStrings.panoramio_overlay+"</legend>"+"<div>"+"<label>"+'<input type="checkbox" id="agm_map_show_panoramio_overlay" /> '+l10nStrings.show_panoramio_overlay+"</label>"+"</div>"+"<div>"+'<label for="agm_map_panoramio_overlay_tag">'+l10nStrings.panoramio_overlay_tag+"</label> "+'<input type="text" size="12" id="agm_map_panoramio_overlay_tag" />'+"</div>"+"<div>"+"<small>"+l10nStrings.panoramio_overlay_tag_help+"</small>"+"</div>"+"</fieldset>"+"<fieldset>"+"<legend>"+l10nStrings.map_alignment+"</legend>"+"<div>"+"<label>"+'<input type="radio" id="agm_map_alignment_left" name="ama" class="agm_map_alignment_element" value="left" /> '+'<img src="'+_agm.root_url+'/img/system/left.png" />'+l10nStrings.map_alignment_left+"</label>"+"</div>"+"<div>"+"<label>"+'<input type="radio" id="agm_map_alignment_center" name="ama" class="agm_map_alignment_element" value="center" /> '+'<img src="'+_agm.root_url+'/img/system/center.png" />'+l10nStrings.map_alignment_center+"</label>"+"</div>"+"<div>"+"<label>"+'<input type="radio" id="agm_map_alignment_right" name="ama" class="agm_map_alignment_element" value="right" /> '+'<img src="'+_agm.root_url+'/img/system/right.png" />'+l10nStrings.map_alignment_right+"</label>"+"</div>"+"</fieldset>"+'<p class="agm_less_important">Global defaults are configured in Settings &gt; WPMU DEV Maps</p>'),jQuery(document).trigger("agm_google_maps-admin-markup_created",[U.find(".agm-preview"),a]),m(),l(),jQuery(document).trigger("agm_google_maps-admin-options_initialized",[U.find(".agm-options"),a]),wpmUi.upgrade_tooltips(),wpmUi.upgrade_multiselect(U),jQuery(".map_preview").width(700).height(.35*jQuery(window).height()),jQuery(document).trigger("agm_google_maps-admin-map_resized",[U,a])}function m(){jQuery("#agm_mh_map_id").val(a.id),a.id||jQuery("#agm_insert_map").attr("disabled",!0),jQuery("#agm_map_title").val(a.title)}function l(){var e=a.show_map&&parseInt(a.show_map)>0,t=a.show_posts&&parseInt(a.show_posts)>0,i=a.show_markers&&parseInt(a.show_markers)>0,n=a.show_images&&parseInt(a.show_images)>0,o=a.show_panoramio_overlay;switch(jQuery("#agm_map_show_map").prop("checked",e),jQuery("#agm_map_show_posts").prop("checked",t),jQuery("#agm_map_show_markers").prop("checked",i),jQuery("#agm_map_show_images").click(p).prop("checked",n),p(),jQuery("#agm_map_show_panoramio_overlay").click(_).prop("checked",o),jQuery("#agm_map_panoramio_overlay_tag").change(u).val(a.panoramio_overlay_tag),a.map_alignment){case"right":jQuery("#agm_map_alignment_right").prop("checked",!0);break;case"center":jQuery("#agm_map_alignment_center").prop("checked",!0);break;default:jQuery("#agm_map_alignment_left").prop("checked",!0)}a.width&&parseInt(a.width)||jQuery("#agm_map_size_default").prop("checked",!0),c(),jQuery.each(a.post_ids,function(e,a){jQuery("#post_ID").val()===a&&jQuery("#agm_map_size_associate").prop("checked",!0)}),jQuery("#agm_map_size_associate").click(g)}function _(){if("object"!=typeof window.google.maps.panoramio)return!1;if(jQuery("#agm_map_show_panoramio_overlay").is(":checked")){var e=jQuery("#agm_map_panoramio_overlay_tag").val();O=new window.google.maps.panoramio.PanoramioLayer,e&&O.setTag(e),O.setMap(L)}else O&&(O.setMap(null),O=!1)}function d(){var e=U.find(".agm-options"),a=U.find(".agm-preview"),t=U.parents(".agm-editor").find(".detail-buttons");return e.is(":visible")?(jQuery(document).trigger("agm_google_maps-admin-options_dialog-closed",[L]),e.hide(),a.show(),t.find("button").hide(),t.find("#agm_insert_map, .agm_go_back, .agm_map_options_open, .agm_save_map").show()):(e.show(),a.hide(),t.find("button").hide(),t.find(".agm_map_options_close").show()),!1}function c(){var e=a.defaults.width,t=a.defaults.height,i=jQuery("#agm_map_size_default").is(":checked");i||(e=parseInt(a.width)>0?a.width:e,t=parseInt(a.height)>0?a.height:t),jQuery("#agm_map_size_x").val(e).attr("disabled",i),jQuery("#agm_map_size_y").val(t).attr("disabled",i)}function p(){var e=jQuery("#agm_map_show_images").is(":checked");jQuery("#agm_map_image_size").attr("disabled",!e),jQuery("#agm_map_image_limit").attr("disabled",!e)}function g(){var e=jQuery("#agm_map_size_associate").val();return jQuery("#agm_map_size_associate").is(":checked")?a.post_ids?a.post_ids.push(e):a.post_ids=[e]:(jQuery('input.agm_mh_associated_id[value="'+e+'"]').remove(),a.post_ids&&(a.post_ids=jQuery.grep(a.post_ids,function(a){return a!==e}))),s(),!0}function u(){var e=jQuery("#agm_map_panoramio_overlay_tag").val();return O?(O.setTag(e),void 0):!0}function v(){a.markers&&jQuery.each(a.markers,function(e,a){h(a.title,new window.google.maps.LatLng(a.position[0],a.position[1]),a.body,a.icon)})}function y(){return h("Untitled marker",L.getCenter()),!1}function h(e,t,i,n){i=i||"",(void 0===n||"string"!=typeof n)&&(n=_agm.root_url+"/img/system/marker.png"),n.match(/^https?:\/\//)||(n=_agm.root_url+"/img/"+n);var o=D.length;L.setCenter(t);var s=new window.google.maps.Marker({title:e,map:L,icon:n,draggable:!0,clickable:!0,position:t,zIndex:100}),r=new window.google.maps.InfoWindow({content:w(e,i,n,o),maxWidth:400});window.google.maps.event.addListener(s,"click",function(){r.open(L,s)}),s._agmInfo=r,a.snapping&&window.google.maps.event.addListener(s,"dragend",function(){var e=new window.google.maps.Geocoder;e.geocode({latLng:s.getPosition()},function(e,a){a===window.google.maps.GeocoderStatus.OK?(s.setPosition(e[0].geometry.location),s.setTitle(e[0].formatted_address),r.setContent(w(e[0].formatted_address,"",s.getIcon(),o)),Q()):window.alert(l10nStrings.geocoding_error)})}),s._agmBody=i,D[o]=s,jQuery(document).trigger("agm_google_maps-admin-marker_added",[s,L]),L._agm_add_marker(s),Q()}function w(e,a,t,i){return t=void 0!==t.url?t.url:""+t,'<div class="agm_mh_info_content"><a href="#" class="agm_mh_info_icon_switch"><img agm:marker_id="'+i+'" src="'+t+'" class="marker-icon-32" /><br /><small>Icon</small></a>'+'<div class="agm_mh_info_text">'+'<div><label for="">'+l10nStrings.title+'</label><br /><input type="text" agm:marker_id="'+i+'" class="agm_mh_info_title" value="'+e+'" /></div>'+'<label for="">'+l10nStrings.body+'</label><textarea class="agm_mh_info_body" agm:marker_id="'+i+'">'+a+"</textarea>"+"</div>"+"</div>"}function f(e){var a=e.replace(/[^0-9]+/,"");return parseInt(a)}function j(){var e=jQuery(this),a=f(e.attr("href")),t=D.splice(a,1);return jQuery(document).trigger("agm_google_maps-admin-marker_removed",[t[0]]),t[0].setMap(null),L._agm_remove_marker(a),Q(),!1}function b(){var e=jQuery(this),t=f(e.attr("href")),i=D[t];if(L.setCenter(i.getPosition()),parseInt(a.street_view)){var n=L.getStreetView();n.setPosition(L.getCenter()),n.setVisible(!0)}return!1}function Q(){var e="<ul>";jQuery.each(D,function(a,t){var i,n=t.getIcon();n=void 0!==n.url?n.url:""+n,i='<li><a href="#agm_mh_marker-'+a+'" class="agm_mh_marker_item">'+'<img src="'+n+'" class="marker-icon-32" />'+t.getTitle()+"</a>"+'<span class="action">'+'<a href="#agm_mh_marker-'+a+'" class="button-secondary agm_mh_marker_delete_item"><i class="dashicons dashicons-trash"></i> '+l10nStrings.delete_item+"</a>"+"</span>"+'<span class="marker-infos">'+'Lat: <span class="click-sel">'+t.position.lat().toFixed(5)+"</span> "+'| Long: <span class="click-sel">'+t.position.lng().toFixed(5)+"</span>"+"</span>"+"</li>",e+=i}),e+="</ul>",jQuery("#agm_mh_markers").html(e)}function k(){var e=jQuery(this).find("img").attr("agm:marker_id"),a=jQuery(this).parent(".agm_mh_info_content"),t=a.html();jQuery.post(window.ajaxurl,{action:"agm_list_icons"},function(i){var n="";jQuery.each(i,function(e,a){n+='<a class="agm_new_icon" href="#"><img src="'+a+'" class="marker-icon-32" /></a> '}),a.html(n),jQuery(".agm_new_icon").click(function(){var i=jQuery(this).find("img").attr("src");a.html(t),a.find("a.agm_mh_info_icon_switch img").attr("src",i).addClass("marker-icon-32");var n=D[e];n.setIcon(i),Q()})})}function x(){var e=jQuery(this),a=e.attr("agm:marker_id"),t=D[a];t.setTitle(e.val()),t._agmInfo.setContent(w(t.getTitle(),t._agmBody,t.getIcon(),a)),Q()}function z(){var e=jQuery(this),a=e.attr("agm:marker_id"),t=D[a];t._agmBody=e.val(),t._agmInfo.setContent(w(t.getTitle(),t._agmBody,t.getIcon(),a)),Q()}function S(){var e=jQuery("#agm_mh_location").val();if(!e)return window.alert(l10nStrings.type_in_location),!1;var a=new window.google.maps.Geocoder;a.geocode({address:e},function(e,a){a===window.google.maps.GeocoderStatus.OK?h(e[0].formatted_address,e[0].geometry.location):window.alert(l10nStrings.geocoding_error)})}function I(){var e,a=jQuery(this)[0];document.selection?(e=document.body.createTextRange(),e.moveToElementText(a),e.select()):window.getSelection&&(e=document.createRange(),e.selectNode(a),window.getSelection().addRange(e))}function C(){if(i(),r(),L=new window.google.maps.Map(jQuery(".map_preview",U).get(0),{zoom:parseInt(a.zoom)?parseInt(a.zoom):1,minZoom:1,center:new window.google.maps.LatLng(40.7171,-74.0039),mapTypeId:window.google.maps.MapTypeId[a.map_type]}),navigator.geolocation&&!a.markers&&navigator.geolocation.getCurrentPosition(function(e){L.setCenter(new window.google.maps.LatLng(e.coords.latitude,e.coords.longitude))}),v(),_(),s(),parseInt(a.street_view)){var e=L.getStreetView(),t=null;t=a.street_view_pos?new window.google.maps.LatLng(a.street_view_pos[0],a.street_view_pos[1]):L.getCenter(),e.setPosition(t),a.street_view_pov&&e.setPov({heading:parseInt(a.street_view_pov.heading),pitch:parseInt(a.street_view_pov.pitch),zoom:parseInt(a.street_view_pov.zoom)}),e.setVisible(!0)}jQuery(document).trigger("agm_google_maps-admin-map_initialized",[L,a]),jQuery("#agm_map_drop_marker").click(y),jQuery(".agm_go_back").click(E),jQuery("#agm_insert_map").click(n),jQuery(".agm_map_options_open").click(d),jQuery(".agm_map_options_close").click(d),jQuery(".agm_save_map").click(o),jQuery("#agm_mh_location_trigger").click(S),jQuery("#agm_map_size_default").click(c),jQuery(document).on("click",".click-sel",I),jQuery("body").on("click",".agm_mh_marker_item",b),jQuery("body").on("click",".agm_mh_marker_delete_item",j),jQuery("body").on("click",".agm_mh_info_icon_switch",k),jQuery("body").on("change",".agm_mh_info_title",x),jQuery("body").on("change",".agm_mh_info_body",z)}function E(){M(),U.trigger("agm_map_close")}function M(){U.empty(),U.parents(".agm-editor").find(".buttons .detail-buttons").remove(),jQuery("body").off("click",".agm_mh_marker_item"),jQuery("body").off("click",".agm_mh_marker_delete_item"),jQuery("body").off("click",".agm_mh_info_icon_switch"),jQuery("body").off("change",".agm_mh_info_title"),jQuery("body").off("change",".agm_mh_info_body")}function T(){window._agmMapIsLoaded?C():window.setTimeout(T,100)}var L,P,V=["medium","small","thumbnail","square","mini_square"],U=jQuery(e),D=[],O=!1;return t=void 0!==t?t:!0,T(),{destroy:M}}});