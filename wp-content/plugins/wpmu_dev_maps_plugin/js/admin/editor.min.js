/*! Google Maps - v2.9.07
 * http://premium.wpmudev.org/project/wordpress-google-maps-plugin
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(function(){function e(){C.size(740,jQuery(window).height()-100)}function t(){var t=function t(){jQuery(document).trigger("agm_map_editor_open"),jQuery(window).on("resize",e)},n=function n(){jQuery(window).off("resize",e),jQuery(document).trigger("agm_map_editor_close"),M=null,C=null};return null===C?C=wpmUi.popup():C.close(),C.title(l10nEditor.google_maps).set_class("agm-editor").modal(!0).content(jQuery("#map_container_src")).onclose(n).show(),M=C.$(),wpmUi.upgrade_tooltips(),t(),!1}function n(){var e={action:"agm_list_maps"};jQuery.post(window.ajaxurl,e,a)}function a(e){if(null!==M){var t,n,i,o=e.maps?e.maps.length:0,r=e.total?parseInt(e.total,10):0,s=jQuery(".agm-paging_bar",M),d=jQuery(".maps_existing_result",M),l=s.length?parseInt(s.attr("data-increment"),10):0,c=l+1,u=l-1;if(r){t=jQuery("<ul></ul>");for(var m=0;e.maps.length>m;m+=1){var p=e.maps[m];t.append('<li class="existing_map_item"><div class="map_item_title"><a href="#" class="edit_map_item" title="'+l10nEditor.preview_or_edit+'">'+p.title+"</a></div>"+'<a href="#" title="'+l10nEditor.use_this_map+'"><code class="map-shortcode add_map_item">['+_agmConfig.shortcode+' id="<strong>'+p.id+'</strong>"]</code></a>'+'<input type="hidden" value="'+p.id+'" />'+'<div class="map_item_actions">'+'<a href="#" class="edit_map_item">'+l10nEditor.preview_or_edit+"</a>"+"&nbsp;|&nbsp;"+'<a href="#" class="add_map_item">'+l10nEditor.use_this_map+"</a>"+'<a href="#" class="delete_map_item"><i class="dashicons dashicons-trash"></i>'+l10nEditor.delete_map+"</a>"+"</div>"+"</li>")}}else t=jQuery('<div class="tc"></div>'),t.append(l10nEditor.no_maps);d.empty().append(t),r>o&&(s=jQuery('<div class="agm-paging_bar" data-increment="'+l+'" />'),s.appendTo(d),u>=0&&(i=jQuery('<a href="#" class="agm-load_prev_maps">'+l10nEditor.load_prev_maps+"</a>"),i.appendTo(s).bind("click",function(){return s.attr("data-increment",u),jQuery.post(window.ajaxurl,{action:"agm_list_maps",increment:u},a),!1})),o&&(n=jQuery('<a href="#" class="agm-load_next_maps">'+l10nEditor.load_next_maps+"</a>"),n.appendTo(s).bind("click",function(){return s.attr("data-increment",c),jQuery.post(window.ajaxurl,{action:"agm_list_maps",increment:c},a),!1}))),o||r||x(),jQuery(window).trigger("resize")}}function i(){if(null!==M){var e=jQuery(this),t=e.parents("li").find("input:hidden").val();C.confirm({message:l10nEditor.delete_confirmation,buttons:[l10nEditor.confirm_delete,l10nEditor.confirm_cancel],callback:function(e){0===e&&o(t)}})}}function o(e){jQuery.post(window.ajaxurl,{action:"agm_delete_map",id:e},function(){n()})}function r(e,t){return null===M?"":e?t&&t.length?" ["+_agmConfig.shortcode+' id="'+e+'"]'+t+"[/"+_agmConfig.shortcode+"] ":" ["+_agmConfig.shortcode+' id="'+e+'"] ':""}function s(){if(null!==M){var e=jQuery(this),t=e.parents("li").find("input:hidden").val(),n=r(t,l());return d(n),C.close(),!1}}function d(e){if(null!==M){var t;window.tinyMCE&&!jQuery("#content").is(":visible")?(t=window.tinyMCE.activeEditor.selection.getContent(),window.tinyMCE.execCommand("mceInsertContent",!0,e)):c(jQuery("#content").get(0),e)}}function l(){if(null!==M){var e,t,n,a,i="";return window.tinyMCE&&!jQuery("#content").is(":visible")?i=window.tinyMCE.activeEditor.selection.getContent():(e=jQuery("#content").get(0),void 0!==document.selection?(e.focus(),t=document.selection.createRange(),i=t.text):void 0!==e.selectionStart&&(n=e.selectionStart,a=e.selectionEnd,i=e.value.substring(n,a))),i}}function c(e,t){if(null!==M){var n,a,i;document.selection&&!window.opera?(e.focus(),n=window.opener.document.selection.createRange(),n.text=t):void 0===e.selectionStart||isNaN(e.selectionStart)?e.value+=t:(a=e.selectionStart,i=e.selectionEnd,e.value=e.value.substring(0,a)+t+e.value.substring(i,e.value.length))}}function u(e){if(null!==M){void 0!==e.title&&e.title.length?C.title(l10nEditor.edit_map):C.title(l10nEditor.new_map);var t=jQuery(".map_preview_container",M);E&&E.destroy(),E=new window.AgmMapHandler(t,e)}}function m(){if(null!==M){var e=jQuery(this),t=e.parents("li").find("input").val();jQuery.post(window.ajaxurl,{action:"agm_load_map",id:t},u),jQuery(".maps_new_switch_container",M).hide(),jQuery(".maps_advanced_container",M).hide(),jQuery(".maps_existing",M).hide()}}function p(){null!==M&&(jQuery.post(window.ajaxurl,{action:"agm_new_map"},u),jQuery(".maps_new_switch_container",M).hide(),jQuery(".maps_advanced_container",M).hide(),jQuery(".maps_existing",M).hide())}function _(){null!==M&&(M.hasClass("advanced-mode")?y():g())}function g(){null!==M&&(M.addClass("advanced-mode"),jQuery("li.existing_map_item").each(function(){var e=jQuery(this),t=e.find("input:hidden").val(),n=jQuery('<div class="map_advanced_checkbox_container"><input type="checkbox" class="map_advanced_checkbox" value="'+t+'" />'+'<div style="clear:both"></div>'+"</div>");e.addClass("advanced-mode"),jQuery(".map_advanced_checkbox",n).click(function(){jQuery(this).prop("checked")?e.addClass("selected"):e.removeClass("selected"),v()}),e.prepend(n)}),jQuery(".advanced_mode_buttons",M).show(),jQuery(".maps_advanced_switch .text",M).text(l10nEditor.advanced_off),jQuery(".maps_merge_locations",M).click(h),jQuery(".maps_batch_delete",M).click(f),v())}function v(){var e=jQuery("li.existing_map_item .map_advanced_checkbox:checked"),t=0===e.length;jQuery(".maps_merge_locations",M).prop("disabled",t),jQuery(".maps_batch_delete",M).prop("disabled",t)}function y(){null!==M&&(M.removeClass("advanced-mode"),jQuery(".map_advanced_checkbox_container",M).remove(),jQuery(".advanced_mode_buttons",M).hide(),jQuery(".existing_map_item.selected",M).removeClass("selected"),jQuery(".existing_map_item.advanced-mode",M).removeClass("advanced-mode"),jQuery(".maps_merge_locations",M).unbind("click"),jQuery(".maps_batch_delete",M).unbind("click"),jQuery(".maps_advanced_mode_help_container",M).html(l10nEditor.advanced_mode_activate_help),jQuery(".maps_advanced_switch .text",M).text(l10nEditor.advanced))}function h(){var e=jQuery("li.existing_map_item .map_advanced_checkbox:checked"),t=[];e.each(function(){t.push(jQuery(this).val())}),jQuery.post(window.ajaxurl,{action:"agm_merge_maps",ids:t},function(e){var t=jQuery(".map_preview_container",M);y(),Q(),E&&E.destroy(),E=new window.AgmMapHandler(t,e),jQuery(".maps_existing",M).hide()})}function f(){if(null!==M){var e=jQuery("li.existing_map_item .map_advanced_checkbox:checked"),t=[];e.each(function(){t.push(jQuery(this).val())}),C.confirm({message:l10nEditor.batch_delete_confirmation,buttons:[l10nEditor.confirm_delete,l10nEditor.confirm_cancel],callback:function(e){0===e&&j(t)}})}}function j(e){jQuery.post(window.ajaxurl,{action:"agm_batch_delete",ids:e},function(){y(),n()})}function w(){var e=jQuery(".map_preview_container",M),t=jQuery(".maps_existing",M),n=jQuery(".maps_new_switch_container",M),a=jQuery(".maps_advanced_container",M);E&&E.destroy(),t.show(),n.show(),a.show(),C.title(l10nEditor.existing_map),jQuery.browser.webkit&&e.css({height:0,width:0})}function Q(){var e=jQuery(".map_preview_container",M),t=jQuery(".maps_existing",M),n=jQuery(".maps_new_switch_container",M),a=jQuery(".maps_advanced_container",M);E&&E.destroy(),t.hide(),n.hide(),a.hide(),jQuery.browser.webkit&&e.css({height:0,width:0})}function b(){null!==M&&(w(),n())}function x(){null!==M&&(Q(),p())}function k(e,t){if(null!==M){var n=r(t);return d(n),C.close(),!1}}var E=!1,C=null,M=null,S=jQuery("#wp-content-media-buttons");S.length&&(S.append('<a title="'+l10nEditor.google_maps+'" class="button add_map" href="#">'+'<img alt="'+l10nEditor.google_maps+'" src="'+_agm.root_url+'/img/system/globe-button.gif">'+"</a>"),jQuery("body").append('<div id="map_container_src" style="display:none"><div id="map_container">'+(_agm.is_multisite?"":'<p class="agm_less_important">For more detailed instructions on how to use refer to <a target="_blank" href="http://premium.wpmudev.org/project/wordpress-google-maps-plugin/#usage">WPMU DEV Maps Installation and Use instructions</a>.</p>')+'<div class="agm_container maps_existing">'+'<div class="maps_existing_result">'+'<div class="tc">'+'<img src="'+_agm.root_url+'/img/system/loading.gif" />'+"</div>"+'<div class="tc">'+l10nEditor.loading+"</div>"+"</div>"+"</div>"+'<div class="map_preview_container"><div class="map_preview"></div></div>'+'<div class="buttons">'+'<span class="maps_advanced_container">'+'<button type="button" class="button-secondary action maps_advanced_switch"'+'data-tooltip="'+l10nEditor.advanced_mode_activate_help+'" data-width="500"'+">"+'<i class="dashicons dashicons-admin-tools"></i> '+'<span class="text">'+l10nEditor.advanced+"</span>"+"</button>"+'<span class="advanced_mode_buttons" style="display:none">'+'<button type="button" class="button-secondary action maps_merge_locations" '+'data-tooltip="'+l10nEditor.advanced_mode_help+'" data-width="500"'+">"+l10nEditor.merge_locations+"</button>"+'<button type="button" class="button-secondary action maps_batch_delete">'+l10nEditor.batch_delete+"</button>"+"</span>"+"</span>"+'<span class="maps_new_switch_container">'+'<button type="button" class="button-secondary action maps_new_switch" '+'data-tooltip="'+l10nEditor.new_map_intro+'" data-width="500"'+">"+'<i class="dashicons dashicons-plus"></i> '+l10nEditor.new_map+"</button>"+"</span>"+"</div>"+"</div></div>"),jQuery(document).on("click",".add_map",t),jQuery(document).on("click",".agm-editor .maps_new_switch",x),jQuery(document).on("agm_map_editor_open",b),jQuery(document).on("agm_map_close",".agm-editor .map_preview_container",b),jQuery(document).on("click","li.existing_map_item .add_map_item",s).on("click","li.existing_map_item .edit_map_item",m).on("click","li.existing_map_item .delete_map_item",i),jQuery(document).on("agm_map_insert",".agm-editor .map_preview_container",k),jQuery(document).on("click",".agm-editor .maps_advanced_switch",_),jQuery("body").on("mouseover","li.existing_map_item",function(){jQuery(this).addClass("agm_active_item")}).on("mouseout","li.existing_map_item",function(){jQuery(this).removeClass("agm_active_item")}))});