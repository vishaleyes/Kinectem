/*! Google Maps - v2.9.07
 * http://premium.wpmudev.org/project/wordpress-google-maps-plugin
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(function(){function e(){window.FB.init({appId:_agmFbnf.fb_app_id,status:!0,cookie:!0,xfbml:!0})}function t(e,t){var i=e.getPosition(),a=i.lat(),n=i.lng(),o=new Date,s=new Date(o.getFullYear(),o.getMonth()-parseInt(_agmFbnf.months),o.getDate()),r="SELECT author_uid, coords FROM location_post WHERE author_uid IN (SELECT uid2 FROM friend WHERE uid1=me()) AND timestamp > "+Math.round(s.getTime()/1e3)+" "+"AND "+"distance(latitude, longitude, '"+a+"', '"+n+"') < "+parseInt(_agmFbnf.radius),l="SELECT id, name, url, pic_square FROM profile WHERE id IN (SELECT author_uid FROM #fql_places)";window.FB.api({method:"fql.multiquery",queries:{fql_places:r,fql_people:l}},function(e){var i=e[0],a=e[1],n=[];jQuery.each(i.fql_result_set,function(){var e=!1,i=this;if(n.indexOf(i.author_uid)>-1)return!0;if(jQuery.each(a.fql_result_set,function(){return this.id!==i.author_uid?!0:(e=this,!1)}),e){n.push(e.id);var o=new window.google.maps.Marker({title:e.name,map:t,icon:e.pic_square,draggable:!1,clickable:!0,position:new window.google.maps.LatLng(i.coords.latitude,i.coords.longitude)}),s=new window.google.maps.InfoWindow({content:'<a href="'+e.url+'" target="_blank">'+e.name+"</a>"});window.google.maps.event.addListener(o,"click",function(){s.open(t,o)})}})})}var i=[];Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;this.length>t;t+=1)if(this[t]===e)return t;return-1}),jQuery(document).bind("agm_google_maps-user-adding_marker",function(e,a,n,o){var s=jQuery("<a href='#nearby-friends'>Nearby friends</a>"),r="agm_google_maps-nearby_friends-"+n+"-body",l=a._agmInfo.getContent();l+=jQuery("<div />").append(s.addClass(r)).html(),a._agmInfo.setContent(l);var c="#"+jQuery(o.getDiv()).attr("id")+" ."+r;return i.indexOf(c)>-1?!0:(i.push(c),jQuery("body").on("click",c,function(){return window.FB.login(function(e){e.authResponse&&t(a,o)},{scope:"user_photos,user_status,friends_photos,friends_status"}),!1}),void 0)}),void 0===window.FB&&(window.fbAsyncInit=e,function(e){var t,i="facebook-jssdk",a=e.getElementsByTagName("script")[0];e.getElementById(i)||(t=e.createElement("script"),t.id=i,t.async=!0,t.src="//connect.facebook.net/en_US/all.js",a.parentNode.insertBefore(t,a))}(document))});